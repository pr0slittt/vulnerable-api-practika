# semgrep-rules/info-disclosure-tokens-get.yaml
rules:
  - id: information-disclosure-tokens-get
    message: |
      GET-метод для эндпоинта /tokens возвращает все данные пользователей, включая пароли.
      Этот маршрут не задокументирован и является серьезной утечкой информации.
    severity: ERROR
    languages:
      - python
    patterns:
      - pattern: |
          @route("/tokens", method="GET")
          def get_get_token():
            ...
            query = "SELECT ... FROM users"
            ...
            return {"response": $USERS}
      - metavariable-pattern:
          metavariable: $USERS
          pattern: |
            users = c.fetchall()
    paths:
      include:
        - vAPI.py
